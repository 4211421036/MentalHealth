class t{constructor(t,e){this.videoElement=t,this.options=e}async start(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const t=await navigator.mediaDevices.getUserMedia({video:{width:this.options.width,height:this.options.height}});this.videoElement.srcObject=t,this.videoElement.onloadedmetadata=()=>{this.videoElement.play(),this.loop()}}}loop(){this.options.onFrame&&this.options.onFrame(),requestAnimationFrame((()=>this.loop()))}stop(){this.videoElement.srcObject&&this.videoElement.srcObject.getTracks().forEach((t=>t.stop()))}}class e{constructor(t){this.options=t,this.onResultsCallback=null}setOptions(t){this.options={...this.options,...t}}onResults(t){this.onResultsCallback=t}async send({image:t}){this.onResultsCallback&&this.onResultsCallback({image:t,multiFaceLandmarks:[]})}}class a{constructor(t,e,a={}){this.videoElement=t,this.canvasElement=e,this.canvasCtx=e.getContext("2d"),this.lastFaceID=null,this.options={maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5,...a},this.EMOTION_THRESHOLDS={HAPPY:.65,SAD:.6,ANGRY:.55,SURPRISED:.5,NEUTRAL:.7},this.initializeFaceMesh()}async initializeFaceMesh(){this.faceMesh=new e({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${t}`}),this.faceMesh.setOptions(this.options),this.faceMesh.onResults(this.onResults.bind(this))}start(){return this.camera=new t(this.videoElement,{onFrame:async()=>{await this.faceMesh.send({image:this.videoElement})},width:640,height:480}),this.camera.start()}stop(){this.camera&&this.camera.stop()}onResults(t){this.canvasCtx.save(),this.canvasCtx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.canvasCtx.drawImage(t.image,0,0,this.canvasElement.width,this.canvasElement.height);let e="";if(t.multiFaceLandmarks&&t.multiFaceLandmarks.length>0){const a=t.multiFaceLandmarks[0];e=this.generateFaceID(a),e!==this.lastFaceID&&(document.head.setAttribute("FaceID",e),this.lastFaceID=e);const s=this.analyzeEmotions(a);this.updateUI(s),t.multiFaceLandmarks.forEach((t=>{this.drawLandmarks(t)}))}else null!==this.lastFaceID&&(document.head.setAttribute("FaceID",""),this.lastFaceID=null);this.canvasCtx.restore()}generateFaceID(t){let e=t.map((t=>t.x.toFixed(4)+t.y.toFixed(4)+t.z.toFixed(4))).join("");return this.djb2Hash(e).toString(16)}djb2Hash(t){let e=5381;for(let a=0;a<t.length;a++)e=33*e^t.charCodeAt(a);return e>>>0}analyzeEmotions(t){const e={happy:this.calculateHappiness(t),sad:this.calculateSadness(t),angry:this.calculateAnger(t),surprised:this.calculateSurprise(t),neutral:this.calculateNeutral(t)},a=Object.values(e).reduce(((t,e)=>t+e),0);return Object.keys(e).forEach((t=>{e[t]=(e[t]/a*100).toFixed(1)})),e}calculateHappiness(t){const e=t[61],a=t[291],s=Math.hypot(a.x-e.x,a.y-e.y),i=t[123],n=t[159].y-i.y;return t[61]&&t[291]&&t[123]&&t[159]?Math.min(1,2*s+3*n):0}calculateSadness(t){const e=t[61],a=t[17].y-e.y,s=t[105],i=t[334],n=(s.y+i.y)/2;return Math.min(1,1.5*a+2*n)}calculateAnger(t){const e=t[46],a=t[105].y-e.y,s=t[0],i=t[17].y-s.y;return Math.min(1,2*a+1.2*i)}calculateSurprise(t){const e=t[159],a=t[145].y-e.y,s=t[152],i=t[4],n=s.y-i.y;return Math.min(1,2*a+.8*n)}calculateNeutral(t){let e=0;return[[152,4],[61,291],[105,334]].forEach((([a,s])=>{e+=Math.hypot(t[a].x-t[s].x,t[a].y-t[s].y)})),Math.max(0,1-2*e)}getMentalHealthConclusion(t){const{happy:e,sad:a,angry:s,surprised:i,neutral:n}=t;return a>40&&e<20&&n<30?{conclusion:"Potensi gejala depresi terdeteksi",advice:"Rekomendasi: Konsultasi dengan profesional kesehatan mental. Pola emosi menunjukkan tanda-tanda depresi.\nKunjungi Media Sosial Berikut Untuk Berkonsultasi\n https://www.instagram.com/peercounselor.unnes?igsh=MXhodHc0bmhpdGdnag=="}:s>35&&e<25?{conclusion:"Tingkat stres tinggi terdeteksi",advice:"Rekomendasi: Lakukan teknik relaksasi dan perhatikan pola tidur."}:n>60?{conclusion:"Emosi stabil",advice:"Pertahankan keseimbangan emosional. Tidak terdeteksi masalah kesehatan mental signifikan."}:{conclusion:"Kondisi emosional normal",advice:"Tidak terdeteksi gangguan mental utama. Tetap pantau kesehatan emosi Anda."}}updateUI(t){Object.entries(t).forEach((([t,e])=>{document.getElementById(t).textContent=e}));const e=this.getMentalHealthConclusion(t);document.getElementById("conclusion").textContent=e.conclusion,document.getElementById("advice").innerHTML=this.autoLinkify(e.advice)}autoLinkify(t){return t.replace(/(https?:\/\/[^\s]+)/g,(t=>`<a href='${t}' target='_blank' title='${t}'>${t}</a>`))}drawLandmarks(t){this.canvasCtx.fillStyle="#00FF00",t.forEach((t=>{const e=t.x*this.canvasElement.width,a=t.y*this.canvasElement.height;this.canvasCtx.beginPath(),this.canvasCtx.arc(e,a,1,0,1*Math.PI),this.canvasCtx.fill()}))}}export{a as EmotionDetection};
//# sourceMappingURL=EmotionDetection.esm.js.map
